{'text': ' Da skal vi se litt på... litt spesifikt på Linux-sheduling. Og i den simuleringen av å lage vaflerør og forelese så er det denne scheduling-algoritmen som jeg tar utgangspunkt i. Men det finnes mange andre scheduling-algoritmer. Windows har en annen. Linux-kjerner er en litt annen kjerne... En litt annen scheduler. Skedulerer, eller tidsfordeler. Og den heter Completely Fair Scheduler, CFS. Den tok over for den som var i Linux 2.6-kjernen, som var i mange 10-15 år. Og det var fordi at den ikke alltid var helt fair. Det var noen da i... I Linux-kjerneutviklergruppa, som kom opp med et forslag til en ny scheduler. Så etter mye testing og feiling og prøving, erstattet den den gamle scheduleren. Det er en O1 scheduler, som betyr at den skalerer sånn at det går like raskt om det er 200 prosesser, eller om det er 10 prosesser som skal scheduleres. Det er det jernmannen forbinder med ordet scheduling. Det er å fordele ressurser blant en rekke enheter som trenger disse ressursene. Scheduling kan brukes i mange tilfeller, men dette er da CPU-scheduling som operativsystemet utfører, som vi ser på nå. Og da... Hver prosess som skal kjøre, tildeles et time count. Og dette time count-et er da målt i jikfis eller tics. Og det er disse hundredelssekundene, eller ti mellisekunder, som vi snakker om. Det er liksom det minste tidsintervallet. Hver gang timeren slår, så er det minste tidsintervallet. Da går det ett tics. Vi har sett på det så vidt i Progstat. Så er det en sånn liste over tics. Da kan man f.eks. se at siste sekund så har man kjørt 80 tics i user mode og 2 tics i curl mode. Med denne prosessen. Da betyr det at denne prosessen har hatt CPU-en omtrent hele tiden. Eller TIKK eller Jiffy. Det er den viktige minste tidsenheten. Men så kommer det en epoke... Det er da en annen og større tidsenhet. Man gir da hver prosess et time count. F.eks. så kan en prosess få 20 enheter med tid i form av TIKS. Så kan da operativstemme prioritere, altså gi en annen enhet... Nei, gi en annen prosess - 40-tics. Og da betyr det at da vel den som får 40-tics, vil da kjøre i snitt dobbelt så lenge som den andre. Og det skal vi se på senere, hvordan vi kan gjøre med nice-kommandoen i Linux. Etter at alle prosessene har fått tildelt sitt time-kontum, En liten bit med tid, så kjører operativsystemet Rovn Robin scheduling. Det betyr at... Rovn Robin, det betyr at man sitter rundt et bord, og så får alle litt tid. Men da er det ikke sånn at bare hver prosess får etikk. Man avbryter det ikke hele tiden. Det kan være effektivt. Og ikke ha for mange avbrudd. For det er litt overhead med en context switch, altså å switche over til en annen prosess. Så dette systemet sørger for at da, hvis det ikke skjer noe spesielt, altså hvis det ikke kommer noe og interrupter, så vil den prosessen som er tildelt 20 tics, den vil fullføre de 20 ticsene i denne epoken. Får den litt fred og ro til å kjøre ferdig. Det blir jo noen sånn 0,2 sekunder, da. Som den... 20 hundredeler, så kjører den. Og så, etterpå, så kommer kanskje den prosessen som har fått ti triks. Så kanskje ikke er flere som har lyst til å kjøre i den epoken. Og da starter en ny epoke. Og så fortsetter det sånn. Og dermed kan operativstøtten avgjøre prioritering av de forskjellige prosessene. Så dette er en måte å dele inn tiden på på en litt mer dynamisk måte enn å bare gi annenhver tics til hver eneste prosess. Den måten ville ha gitt litt mye overhead. Så må vi også huske på at timeticsene er definert av operativsystemet. Man har testet ut i noen skeduer... I 26-kjernen kan man programmere den lengden. Så det går an å sette 1 ms eller 100 ms, men da oppfører systemet seg litt forskjellig. Etter hvert timertick så sjekkes det om den prosessen som kjører, har flere tics igjen, altså om telleren til prosessen er større enn null. Så kaller man ikke scheduleren. Da bare fortsetter den å kjøre til den er ferdig med sin epoke. Altså da typisk med sine 20 tics. Og så er epoken over når alle prosesser har brukt opp sin tid. Og da counter er null for alle prosesser. Og da starter man på nytt. Og så deler scheduleren ut tics til alle prosesser. Som ønsker å kjøre. Det er da en variabel som kalles priority, eller prioritet. Og den bestemmer da hvor mye CPU-tid prosessene skal få. Og en prosess kan faktisk senke sin egen prioritet. Den kan be om lavere prioritet. I Linux gjør man det med command og nice, og da får den prosessen mindre prioritet. Vanligvis prøver operativstemma å være så fair som bare mulig. Alle som ønsker CPU, tildeles omtrent like mye mange tics. Og det er dette vi ser, som vi så på i forrige uke, da vi kjørte fire og åtte prosesser på samme CPU. Det operativstemma gjør, er å tildele tics. Og den tildeler da i utgangspunktet like mange tics til hver av prosessene. En time-countum vil da kunne variere, sånn statistisk. For dette er en dynamisk schedulering. For hver epoke så deles det ut nye tics. Og her er en sånn statistikk i Linux kjerne 2.4, som var gjennomsnittlig time-countum på 210 millisekunder. Altså man måler og ser hvor langt er time-countum-en når du kjører en masse prosesser på... Og i 2006 var det omtrent 100 millisekunder. Hva var en epoke igjen? Jo, en epoke, det er liksom... Det er ikke en fast tid, men det er... Ved starten av en epoke, så har operativsummet, så sjekker den en ready-liste, altså en liste over alle prosesser Det kan jo være noen som ligger i vektstilling eller venter på input og upput, eller av en eller annen grunn ikke ønsker å kjøre. Men alle prosesser som en ønsker å kjøre, de blir da tildelt et time-kontum. Da kan det være at Prosess A får 30 tics. Prosess B får 20 tics. Prosess C får 10 tics. Så setter man i gang og kjører. Epoken defineres da av det tidsrommet 30 pluss 20 pluss 10. Og hvis ikke noe spesielt skjer, så kjøres de 60 ticsene, og så starter man på nytt igjen. Men da kan det være litt avhengig om prosessen faktisk har brukt opp sine tics. Så kan Operativstemme dynamisk da tildele tics etter hvor mange man har brukt. Det typiske er at hvis man ikke bruker noe særlig med tics, så får man flere neste gang, sånn at man får høyere prioritet. Det er en del oppgaver denne uken, og så kan man også se på den vaffelrør-skreduleringen. Der bruker jeg akkurat dette her. Nå evaluerer de forskjellig. Vaffelprosessen og forelesningsprosessen har litt forskjellig prioritet. Men hvis det kommer et time-tick, så kan det være at den samme prosessen fortsetter litt til. Og det er for å gjøre det mer effektivt.', 'chunks': [{'timestamp': (0.02, 7.32), 'text': ' Da skal vi se litt på... litt spesifikt på Linux-sheduling.'}, {'timestamp': (7.32, 14.14), 'text': ' Og i den simuleringen av å lage vaflerør og forelese'}, {'timestamp': (14.14, 20.18), 'text': ' så er det denne scheduling-algoritmen som jeg tar utgangspunkt i.'}, {'timestamp': (20.18, 26.3), 'text': ' Men det finnes mange andre scheduling-algoritmer. Windows har en annen.'}, {'timestamp': (30.0, 35.16), 'text': ' Linux-kjerner er en litt annen kjerne...'}, {'timestamp': (35.24, 38.16), 'text': ' En litt annen scheduler.'}, {'timestamp': (38.16, 41.6), 'text': ' Skedulerer, eller tidsfordeler.'}, {'timestamp': (41.66, 45.28), 'text': ' Og den heter Completely Fair Scheduler, CFS.'}, {'timestamp': (45.28, 49.24), 'text': ' Den tok over for den som var i Linux 2.6-kjernen,'}, {'timestamp': (49.32, 53.08), 'text': ' som var i mange 10-15 år.'}, {'timestamp': (54.44, 59.98), 'text': ' Og det var fordi at den ikke alltid var helt fair. Det var noen da i...'}, {'timestamp': (60.0, 68.08), 'text': ' I Linux-kjerneutviklergruppa, som kom opp med et forslag til en ny scheduler.'}, {'timestamp': (68.16, 75.08), 'text': ' Så etter mye testing og feiling og prøving, erstattet den den gamle scheduleren.'}, {'timestamp': (75.1, 82.18), 'text': ' Det er en O1 scheduler, som betyr at den skalerer sånn at'}, {'timestamp': (82.2, 89.12), 'text': ' det går like raskt om det er 200 prosesser, eller om det er 10 prosesser som skal scheduleres.'}, {'timestamp': (90.0, 96.2), 'text': ' Det er det jernmannen forbinder med ordet scheduling.'}, {'timestamp': (96.2, 102.08), 'text': ' Det er å fordele ressurser blant en rekke enheter'}, {'timestamp': (102.16, 105.08), 'text': ' som trenger disse ressursene.'}, {'timestamp': (105.16, 108.52), 'text': ' Scheduling kan brukes i mange tilfeller,'}, {'timestamp': (108.6, 112.96), 'text': ' men dette er da CPU-scheduling som operativsystemet utfører,'}, {'timestamp': (113.04, 116.0), 'text': ' som vi ser på nå.'}, {'timestamp': (120.0, 126.16), 'text': ' Og da... Hver prosess som skal kjøre, tildeles et time count.'}, {'timestamp': (126.16, 131.24), 'text': ' Og dette time count-et er da målt i jikfis eller tics.'}, {'timestamp': (131.32, 135.64), 'text': ' Og det er disse hundredelssekundene, eller ti mellisekunder,'}, {'timestamp': (135.72, 140.56), 'text': ' som vi snakker om. Det er liksom det minste tidsintervallet.'}, {'timestamp': (140.56, 146.64), 'text': ' Hver gang timeren slår, så er det minste tidsintervallet.'}, {'timestamp': (150.0, 157.06), 'text': ' Da går det ett tics. Vi har sett på det så vidt i Progstat.'}, {'timestamp': (157.08, 162.92), 'text': ' Så er det en sånn liste over tics. Da kan man f.eks. se at'}, {'timestamp': (163.0, 171.44), 'text': ' siste sekund så har man kjørt 80 tics i user mode og 2 tics i curl mode.'}, {'timestamp': (171.44, 178.68), 'text': ' Med denne prosessen. Da betyr det at denne prosessen har hatt CPU-en omtrent hele tiden.'}, {'timestamp': (180.0, 186.44), 'text': ' Eller TIKK eller Jiffy. Det er den viktige minste tidsenheten.'}, {'timestamp': (187.36, 190.8), 'text': ' Men så kommer det en epoke...'}, {'timestamp': (191.24, 196.96), 'text': ' Det er da en annen og større tidsenhet.'}, {'timestamp': (196.96, 200.44), 'text': ' Man gir da hver prosess et time count.'}, {'timestamp': (200.52, 207.28), 'text': ' F.eks. så kan en prosess få 20 enheter med tid i form av TIKS.'}, {'timestamp': (210.0, 215.46), 'text': ' Så kan da operativstemme prioritere, altså gi en annen enhet...'}, {'timestamp': (215.46, 219.78), 'text': ' Nei, gi en annen prosess - 40-tics.'}, {'timestamp': (219.78, 223.94), 'text': ' Og da betyr det at da vel den som får 40-tics,'}, {'timestamp': (223.98, 227.54), 'text': ' vil da kjøre i snitt dobbelt så lenge som den andre.'}, {'timestamp': (227.56, 234.56), 'text': ' Og det skal vi se på senere, hvordan vi kan gjøre med nice-kommandoen i Linux.'}, {'timestamp': (234.66, 238.94), 'text': ' Etter at alle prosessene har fått tildelt sitt time-kontum,'}, {'timestamp': (240.0, 246.96), 'text': ' En liten bit med tid, så kjører operativsystemet Rovn Robin scheduling.'}, {'timestamp': (247.0, 253.12), 'text': ' Det betyr at... Rovn Robin, det betyr at man sitter rundt et bord,'}, {'timestamp': (253.2, 256.4), 'text': ' og så får alle litt tid.'}, {'timestamp': (256.4, 263.88), 'text': ' Men da er det ikke sånn at bare hver prosess får etikk.'}, {'timestamp': (265.64, 269.92), 'text': ' Man avbryter det ikke hele tiden. Det kan være effektivt.'}, {'timestamp': (270.0, 274.8), 'text': ' Og ikke ha for mange avbrudd.'}, {'timestamp': (275.48, 280.48), 'text': ' For det er litt overhead med en context switch,'}, {'timestamp': (280.56, 283.76), 'text': ' altså å switche over til en annen prosess.'}, {'timestamp': (283.84, 288.64), 'text': ' Så dette systemet sørger for at da, hvis det ikke skjer noe spesielt,'}, {'timestamp': (288.72, 292.8), 'text': ' altså hvis det ikke kommer noe og interrupter, så vil den prosessen'}, {'timestamp': (292.88, 298.92), 'text': ' som er tildelt 20 tics, den vil fullføre de 20 ticsene i denne epoken.'}, {'timestamp': (300.0, 306.08), 'text': ' Får den litt fred og ro til å kjøre ferdig.'}, {'timestamp': (306.96, 311.68), 'text': ' Det blir jo noen sånn 0,2 sekunder, da. Som den... 20 hundredeler, så kjører den.'}, {'timestamp': (311.68, 317.18), 'text': ' Og så, etterpå, så kommer kanskje den prosessen som har fått ti triks.'}, {'timestamp': (317.9, 323.52), 'text': ' Så kanskje ikke er flere som har lyst til å kjøre i den epoken. Og da starter en ny epoke.'}, {'timestamp': (323.52, 329.6), 'text': ' Og så fortsetter det sånn. Og dermed kan operativstøtten avgjøre prioritering av de forskjellige prosessene.'}, {'timestamp': (330.0, 335.08), 'text': ' Så dette er en måte å dele inn tiden på'}, {'timestamp': (335.08, 340.2), 'text': ' på en litt mer dynamisk måte'}, {'timestamp': (340.28, 344.68), 'text': ' enn å bare gi annenhver tics til hver eneste prosess.'}, {'timestamp': (344.76, 348.76), 'text': ' Den måten ville ha gitt litt mye overhead.'}, {'timestamp': (348.76, 355.0), 'text': ' Så må vi også huske på at timeticsene er definert av operativsystemet.'}, {'timestamp': (355.08, 359.0), 'text': ' Man har testet ut i noen skeduer...'}, {'timestamp': (360.0, 364.4), 'text': ' I 26-kjernen kan man programmere den lengden.'}, {'timestamp': (365.52, 369.08), 'text': ' Så det går an å sette 1 ms eller 100 ms,'}, {'timestamp': (369.08, 375.0), 'text': ' men da oppfører systemet seg litt forskjellig.'}, {'timestamp': (378.52, 384.88), 'text': ' Etter hvert timertick så sjekkes det om den prosessen som kjører,'}, {'timestamp': (384.92, 388.64), 'text': ' har flere tics igjen, altså om telleren til prosessen er større enn null.'}, {'timestamp': (390.0, 394.96), 'text': ' Så kaller man ikke scheduleren. Da bare fortsetter den å kjøre'}, {'timestamp': (394.96, 402.16), 'text': ' til den er ferdig med sin epoke. Altså da typisk med sine 20 tics.'}, {'timestamp': (402.16, 407.48), 'text': ' Og så er epoken over når alle prosesser har brukt opp sin tid.'}, {'timestamp': (407.48, 413.72), 'text': ' Og da counter er null for alle prosesser. Og da starter man på nytt.'}, {'timestamp': (413.84, 419.6), 'text': ' Og så deler scheduleren ut tics til alle prosesser.'}, {'timestamp': (420.0, 423.62), 'text': ' Som ønsker å kjøre.'}, {'timestamp': (423.62, 429.52), 'text': ' Det er da en variabel som kalles priority, eller prioritet.'}, {'timestamp': (429.54, 435.68), 'text': ' Og den bestemmer da hvor mye CPU-tid prosessene skal få.'}, {'timestamp': (435.68, 440.52), 'text': ' Og en prosess kan faktisk senke sin egen prioritet.'}, {'timestamp': (440.6, 443.48), 'text': ' Den kan be om lavere prioritet.'}, {'timestamp': (443.48, 449.68), 'text': ' I Linux gjør man det med command og nice, og da får den prosessen mindre prioritet.'}, {'timestamp': (450.0, 454.0), 'text': ' Vanligvis prøver operativstemma å være så fair som bare mulig.'}, {'timestamp': (454.0, 459.4), 'text': ' Alle som ønsker CPU, tildeles omtrent like mye mange tics.'}, {'timestamp': (459.48, 463.28), 'text': ' Og det er dette vi ser, som vi så på i forrige uke,'}, {'timestamp': (463.28, 467.88), 'text': ' da vi kjørte fire og åtte prosesser på samme CPU.'}, {'timestamp': (467.88, 471.68), 'text': ' Det operativstemma gjør, er å tildele tics.'}, {'timestamp': (471.76, 478.2), 'text': ' Og den tildeler da i utgangspunktet like mange tics til hver av prosessene.'}, {'timestamp': (480.0, 486.08), 'text': ' En time-countum vil da kunne variere, sånn statistisk.'}, {'timestamp': (486.16, 490.24), 'text': ' For dette er en dynamisk schedulering.'}, {'timestamp': (490.24, 493.24), 'text': ' For hver epoke så deles det ut nye tics.'}, {'timestamp': (493.26, 499.28), 'text': ' Og her er en sånn statistikk i Linux kjerne 2.4,'}, {'timestamp': (499.4, 504.56), 'text': ' som var gjennomsnittlig time-countum på 210 millisekunder.'}, {'timestamp': (504.56, 508.92), 'text': ' Altså man måler og ser hvor langt er time-countum-en når du kjører en masse prosesser på...'}, {'timestamp': (510.0, 516.32), 'text': ' Og i 2006 var det omtrent 100 millisekunder.'}, {'timestamp': (516.32, 523.24), 'text': ' Hva var en epoke igjen? Jo, en epoke, det er liksom...'}, {'timestamp': (523.26, 528.64), 'text': ' Det er ikke en fast tid, men det er...'}, {'timestamp': (528.64, 534.2), 'text': ' Ved starten av en epoke, så har operativsummet,'}, {'timestamp': (534.28, 538.76), 'text': ' så sjekker den en ready-liste, altså en liste over alle prosesser'}, {'timestamp': (538.84, 538.76), 'text': ''}, {'timestamp': (544.24, 544.32), 'text': ' Det kan jo være noen som ligger i vektstilling'}, {'timestamp': (550.32, 550.4), 'text': ' eller venter på input og upput, eller av en eller annen grunn ikke ønsker å kjøre.'}, {'timestamp': (558.64, 558.76), 'text': ' Men alle prosesser som en ønsker å kjøre, de blir da tildelt et time-kontum.'}, {'timestamp': (563.52, 563.6), 'text': ' Da kan det være at Prosess A får 30 tics.'}, {'timestamp': (567.44, 568.76), 'text': ' Prosess B får 20 tics. Prosess C får 10 tics.'}, {'timestamp': (571.36, 571.44), 'text': ' Så setter man i gang og kjører.'}, {'timestamp': (576.92, 577.0), 'text': ' Epoken defineres da av det tidsrommet 30 pluss 20 pluss 10.'}, {'timestamp': (580.44, 585.94), 'text': ' Og hvis ikke noe spesielt skjer, så kjøres de 60 ticsene, og så starter man på nytt igjen.'}, {'timestamp': (585.94, 593.52), 'text': ' Men da kan det være litt avhengig om prosessen faktisk har brukt opp sine tics.'}, {'timestamp': (594.64, 593.52), 'text': ''}, {'timestamp': (601.28, 601.36), 'text': ' Så kan Operativstemme dynamisk da tildele tics etter hvor mange man har brukt.'}, {'timestamp': (606.32, 611.72), 'text': ' Det typiske er at hvis man ikke bruker noe særlig med tics, så får man flere neste gang, sånn at man får høyere prioritet.'}, {'timestamp': (611.72, 616.84), 'text': ' Det er en del oppgaver denne uken, og så kan man også se på'}, {'timestamp': (616.84, 622.52), 'text': ' den vaffelrør-skreduleringen. Der bruker jeg akkurat dette her.'}, {'timestamp': (623.52, 626.24), 'text': ' Nå evaluerer de forskjellig.'}, {'timestamp': (626.32, 631.32), 'text': ' Vaffelprosessen og forelesningsprosessen har litt forskjellig prioritet.'}, {'timestamp': (631.4, 636.44), 'text': ' Men hvis det kommer et time-tick, så kan det være'}, {'timestamp': (636.52, 639.72), 'text': ' at den samme prosessen fortsetter litt til.'}, {'timestamp': (639.76, 643.12), 'text': ' Og det er for å gjøre det mer effektivt.'}]}