{'text': ' Det som kan være interessant da, er å se på... Hvordan er det egentlig Javakoden som... Hvordan ser Javakoden som kjører dette her? Hvordan ser den ut? Og da er det en egen... En egen applikasjon, Javap, som kan vise... Javabyte-kode. Men hvis vi tar på Minus Private, så får man se akkurat den koden som kjører saldotråden. Vi kan kjøre den kommandoen. Så det jeg gjorde, var Javap Minus Private på saldotredd. Og det vi ser her, det er Java Bite-kode. Så jeg... Det kan jo minne litt om Assembler-kode. Den eneste forskjellen er at Assembler-kode er for X86 fysiske maskiner. Mens denne Java Bite-koden, den er for en Java virtuell maskin. Og... Da kan vi prøve oss å finne ut... Jo, her er den Update saldo. Det er den metoden som oppdaterer saldoen. Da kan vi se at det er to områder her. Her er det en e-ad, og her er det en e-sub. Og dette er de to områdene som saldoen blir oppdatert i. Og hvis vi konsentrerer oss om den delen som gjør... Dette er da tråd 1, som gjør saldo pluss, pluss. Og da skal jeg ikke gå så veldig inn på dette i detalj, men JVM er en såkalt stackmaskin. Det vil si at den legger variabler på stacken, og så opererer den på stacken. Så det som faktisk foregår her, er... Her er det getstatic. Det betyr hente inn saldoen. Så hvis saldoen er 50, så legges... Og så icons1. Den sier... Den legger tallet 1 på stacken. Og eadd, den legger sammen de to tallene. Så da tar den 50 pluss 1 får 51. Og så gjør den put static og legger verdien ut. Og helt tilsvarende skjer med sub her nede. Da ser vi med en gang at dette tar litt tid. Først så hentes verdien inn og legges på sekken. Og dette implementeres jo da igjen av JVM, som så kjører maskinkode som gjør dette her. Så det som er tydelig, er at saldo blir lagt inn og så legges i registeret som bare denne prosessen eier. Og den aner da ikke noe om hva som skjer her nede. Så når dette kjøres samtidig, Så er det helt kaos. Saldo hentes inn, men det er ikke noe kontroll på hvor mange ganger det gjøres. Det er ingen kontroll på at det ikke kan bli et avbrudd akkurat her. Og så overføres CPU-en til den andre tråden, og så trekker den fra. Og på en måte enda verre blir det når disse trådene opererer på hver sin CPU. For da jobber de helt uavhengig av hverandre. Og henter inn og ut saldo hele tiden uten å kontrollere hva den andre gjør i mellomtiden. Så det er helt klart at for at dette skal virke, så må man serialisere. Nøyaktig hvordan det gjøres, skal vi se på neste gang, etter påske. Men det er en metode som heter synchronized, som man kan bruke. Som da synkroniserer trådene i forhold til hverandre. Det som uansett er sikkert, er at hvis man ikke tar hensyn til dette her, hvis man ikke gjør programmene trådsikre, ikke tenker på race conditions, så kan ting som dette her oppstå. At man kjører samme programmet to ganger, og så er det helt vilkårlig hva man får ut som resultat.', 'chunks': [{'timestamp': (0.0, 7.04), 'text': ' Det som kan være interessant da, er å se på...'}, {'timestamp': (7.12, 13.28), 'text': ' Hvordan er det egentlig Javakoden som...'}, {'timestamp': (13.6, 20.4), 'text': ' Hvordan ser Javakoden som kjører dette her?'}, {'timestamp': (20.48, 26.72), 'text': ' Hvordan ser den ut? Og da er det en egen...'}, {'timestamp': (30.0, 37.2), 'text': ' En egen applikasjon, Javap, som kan vise...'}, {'timestamp': (37.2, 38.6), 'text': ' Javabyte-kode.'}, {'timestamp': (38.62, 44.04), 'text': ' Men hvis vi tar på Minus Private, så får man se'}, {'timestamp': (44.04, 49.2), 'text': ' akkurat den koden som kjører saldotråden.'}, {'timestamp': (51.34, 53.84), 'text': ' Vi kan kjøre den kommandoen.'}, {'timestamp': (54.04, 59.96), 'text': ' Så det jeg gjorde, var Javap Minus Private på saldotredd.'}, {'timestamp': (60.02, 65.4), 'text': ' Og det vi ser her, det er Java Bite-kode.'}, {'timestamp': (65.42, 72.06), 'text': ' Så jeg... Det kan jo minne litt om Assembler-kode.'}, {'timestamp': (72.06, 77.38), 'text': ' Den eneste forskjellen er at Assembler-kode er for X86 fysiske maskiner.'}, {'timestamp': (77.5, 83.06), 'text': ' Mens denne Java Bite-koden, den er for en Java virtuell maskin.'}, {'timestamp': (83.06, 89.98), 'text': ' Og... Da kan vi prøve oss å finne ut...'}, {'timestamp': (90.0, 93.26), 'text': ' Jo, her er den Update saldo.'}, {'timestamp': (93.28, 96.88), 'text': ' Det er den metoden som oppdaterer saldoen.'}, {'timestamp': (96.88, 101.52), 'text': ' Da kan vi se at det er to områder her.'}, {'timestamp': (101.6, 104.6), 'text': ' Her er det en e-ad, og her er det en e-sub.'}, {'timestamp': (104.6, 108.2), 'text': ' Og dette er de to områdene som saldoen blir oppdatert i.'}, {'timestamp': (108.32, 115.0), 'text': ' Og hvis vi konsentrerer oss om den delen som gjør...'}, {'timestamp': (115.68, 118.8), 'text': ' Dette er da tråd 1, som gjør saldo pluss, pluss.'}, {'timestamp': (120.0, 125.46), 'text': ' Og da skal jeg ikke gå så veldig inn på dette i detalj,'}, {'timestamp': (125.48, 128.96), 'text': ' men JVM er en såkalt stackmaskin.'}, {'timestamp': (128.98, 134.54), 'text': ' Det vil si at den legger variabler på stacken,'}, {'timestamp': (134.62, 137.74), 'text': ' og så opererer den på stacken.'}, {'timestamp': (137.82, 142.42), 'text': ' Så det som faktisk foregår her, er...'}, {'timestamp': (142.44, 148.4), 'text': ' Her er det getstatic. Det betyr hente inn saldoen. Så hvis saldoen er 50, så legges...'}, {'timestamp': (150.0, 157.2), 'text': ' Og så icons1. Den sier... Den legger tallet 1 på stacken.'}, {'timestamp': (157.28, 161.44), 'text': ' Og eadd, den legger sammen de to tallene.'}, {'timestamp': (162.44, 164.96), 'text': ' Så da tar den 50 pluss 1 får 51.'}, {'timestamp': (164.96, 171.36), 'text': ' Og så gjør den put static og legger verdien ut.'}, {'timestamp': (171.44, 176.24), 'text': ' Og helt tilsvarende skjer med sub her nede.'}, {'timestamp': (180.0, 184.12), 'text': ' Da ser vi med en gang at dette tar litt tid.'}, {'timestamp': (184.2, 187.68), 'text': ' Først så hentes verdien inn og legges på sekken.'}, {'timestamp': (187.68, 191.28), 'text': ' Og dette implementeres jo da igjen av JVM,'}, {'timestamp': (191.36, 195.44), 'text': ' som så kjører maskinkode som gjør dette her.'}, {'timestamp': (195.44, 199.76), 'text': ' Så det som er tydelig, er at saldo blir lagt inn'}, {'timestamp': (199.84, 203.88), 'text': ' og så legges i registeret som bare denne prosessen eier.'}, {'timestamp': (203.96, 209.8), 'text': ' Og den aner da ikke noe om hva som skjer her nede. Så når dette kjøres samtidig,'}, {'timestamp': (210.0, 216.2), 'text': ' Så er det helt kaos. Saldo hentes inn, men det er ikke noe kontroll på'}, {'timestamp': (216.2, 220.48), 'text': ' hvor mange ganger det gjøres. Det er ingen kontroll på'}, {'timestamp': (220.58, 225.08), 'text': ' at det ikke kan bli et avbrudd akkurat her.'}, {'timestamp': (225.16, 231.96), 'text': ' Og så overføres CPU-en til den andre tråden, og så trekker den fra.'}, {'timestamp': (231.96, 238.2), 'text': ' Og på en måte enda verre blir det når disse trådene opererer på hver sin CPU.'}, {'timestamp': (238.28, 239.8), 'text': ' For da jobber de helt uavhengig av hverandre.'}, {'timestamp': (240.0, 243.78), 'text': ' Og henter inn og ut saldo hele tiden'}, {'timestamp': (243.78, 248.68), 'text': ' uten å kontrollere hva den andre gjør i mellomtiden.'}, {'timestamp': (248.68, 253.72), 'text': ' Så det er helt klart at for at dette skal virke, så må man serialisere.'}, {'timestamp': (253.72, 261.96), 'text': ' Nøyaktig hvordan det gjøres, skal vi se på neste gang, etter påske.'}, {'timestamp': (261.96, 266.4), 'text': ' Men det er en metode som heter synchronized, som man kan bruke.'}, {'timestamp': (266.4, 269.98), 'text': ' Som da synkroniserer trådene i forhold til hverandre.'}, {'timestamp': (270.0, 276.34), 'text': ' Det som uansett er sikkert, er at hvis man ikke tar hensyn til dette her,'}, {'timestamp': (276.42, 281.62), 'text': ' hvis man ikke gjør programmene trådsikre, ikke tenker på race conditions,'}, {'timestamp': (281.64, 287.6), 'text': ' så kan ting som dette her oppstå. At man kjører samme programmet to ganger,'}, {'timestamp': (287.62, 293.52), 'text': ' og så er det helt vilkårlig hva man får ut som resultat.'}]}