<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2021 (Released January 1, 2021) -->
<HTML lang="en">
<HEAD>
<TITLE>9 Forelesning 19/3-26(2 timer). Prosesser, OS-arkitektur</TITLE>
<META NAME="description" CONTENT="9 Forelesning 19/3-26(2 timer). Prosesser, OS-arkitektur">
<META NAME="keywords" CONTENT="os">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2021">

<LINK REL="STYLESHEET" HREF="../../../os.css">

</HEAD>

<BODY  bgcolor="#ffffff">
<!--Table of Child-Links-->
<A ID="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A ID="tex2html1031"
  HREF="node10.html#SECTION000101000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Video av forelesningen</A>
<UL>
<LI><A ID="tex2html1032"
  HREF="node10.html#SECTION000101100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Slides brukt i forelesningen</A>
</UL>
<BR>
<LI><A ID="tex2html1033"
  HREF="node10.html#SECTION000102000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Sist</A>
<LI><A ID="tex2html1034"
  HREF="node10.html#SECTION000103000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Systemkall og timer ticks</A>
<LI><A ID="tex2html1035"
  HREF="node10.html#SECTION000104000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN> Prioritet</A>
<UL>
<LI><A ID="tex2html1036"
  HREF="node10.html#SECTION000104100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Scheduling-algoritmer</A>
<LI><A ID="tex2html1037"
  HREF="node10.html#SECTION000104200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Linux-eksempel: nice</A>
</UL>
<BR>
<LI><A ID="tex2html1038"
  HREF="node10.html#SECTION000105000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">5</SPAN> Prosess-prioritet i Windows</A>
<LI><A ID="tex2html1039"
  HREF="node10.html#SECTION000106000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN> Prosessforløp</A>
<UL>
<LI><A ID="tex2html1040"
  HREF="node10.html#SECTION000106100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Sentrale schedulingbegreper</A>
<LI><A ID="tex2html1041"
  HREF="node10.html#SECTION000106200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">2</SPAN> Prosessforløp-demo</A>
</UL>
<BR>
<LI><A ID="tex2html1042"
  HREF="node10.html#SECTION000107000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN> Lage en ny prosess</A>
<UL>
<LI><A ID="tex2html1043"
  HREF="node10.html#SECTION000107100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux: fork()</A>
<LI><A ID="tex2html1044"
  HREF="node10.html#SECTION000107200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">2</SPAN> Windows: CreateProcess</A>
</UL>
<BR>
<LI><A ID="tex2html1045"
  HREF="node10.html#SECTION000108000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN> Avslutte prosesser</A>
<UL>
<LI><A ID="tex2html1046"
  HREF="node10.html#SECTION000108100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Signaler</A>
<LI><A ID="tex2html1047"
  HREF="node10.html#SECTION000108200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Signaler og trap i bash-script</A>
</UL>
<BR>
<LI><A ID="tex2html1048"
  HREF="node10.html#SECTION000109000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN> OS arkitektur</A>
<UL>
<LI><A ID="tex2html1049"
  HREF="node10.html#SECTION000109100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux arkitektur</A>
<LI><A ID="tex2html1050"
  HREF="node10.html#SECTION000109200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Windows arkitektur</A>
</UL>
<BR>
<LI><A ID="tex2html1051"
  HREF="node10.html#SECTION0001010000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">10</SPAN> Design av systemkommandoer</A>
<UL>
<LI><A ID="tex2html1052"
  HREF="node10.html#SECTION0001010100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux-eksempel: setuid-bit</A>
</UL>
<BR>
<LI><A ID="tex2html1053"
  HREF="node10.html#SECTION0001011000000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN> Utbredelse av Operativsystemer</A>
<UL>
<LI><A ID="tex2html1054"
  HREF="node10.html#SECTION0001011100000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Desktop OS</A>
<LI><A ID="tex2html1055"
  HREF="node10.html#SECTION0001011200000000000000"><SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Server OS</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A ID="SECTION000100000000000000000">
<SPAN CLASS="arabic">9</SPAN> Forelesning 19/3-26(2 timer).  Prosesser, OS-arkitektur</A>
</H1>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

Avsnitt fra Tanenbaum: 2.1 - 2.2
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<H2><A ID="SECTION000101000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Video av forelesningen</A>
</H2>
Opptak av forelesningen:

<P>
<A ID="tex2html229"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9time1.mp4">os9time1.mp4</A>
(41:31) Uredigert opptak av første time av forelesningen. 
<BR><A ID="tex2html230"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9time2.mp4">os9time2.mp4</A>
(53:05) Uredigert opptak av andre time av forelesningen. 
<BR>
<P>
Opptak av forelesningen inndelt etter temaer:  (lydkvaliteten blir desverre litt dårligere, men høyere, mitt i avsnittet om nice)

<P>
<A ID="tex2html231"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del1.mp4">os9del1.mp4</A>
(03:10) Intro, om kurset fremover, om dagens temaer, eksamen

<BR><A ID="tex2html232"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del2.mp4">os9del2.mp4</A>
(07:09) Om ukens oppgaver, docker og ryddescript, dockerfiles, lite disk på serveren

<BR><A ID="tex2html233"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del3.mp4">os9del3.mp4</A>
(18:15) Demo av systemkall med getppid.c

<BR><A ID="tex2html234"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del4.mp4">os9del4.mp4</A>
(04:15) Slides: Prioritet og scheduling-algoritmer

<BR><A ID="tex2html235"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del5.mp4">os9del5.mp4</A>
(07:19) Slides og demo: nice; lydkvaliteten blir desverre dårligere mitt i opptaket

<BR><A ID="tex2html236"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del6.mp4">os9del6.mp4</A>
(10:01) Demo: hvorfor ingen effekt av nice? nice med taskset

<BR><A ID="tex2html237"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del7.mp4">os9del7.mp4</A>
(01:00) Slides: prioritet i Windows

<BR><A ID="tex2html238"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del8.mp4">os9del8.mp4</A>
(04:02) Slides og demo: Prosessforløp

<BR><A ID="tex2html239"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del9.mp4">os9del9.mp4</A>
(00:58) Slide: Schedulingbegreper

<BR><A ID="tex2html240"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del10.mp4">os9del10.mp4</A>
(05:16) Slides: Lage nye prosesser, parent og child, Linux fork

<BR><A ID="tex2html241"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del11.mp4">os9del11.mp4</A>
(01:22) Slide: Windows CreateProcess

<BR><A ID="tex2html242"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del12.mp4">os9del12.mp4</A>
(04:41) Slides: avslutte prosesser og signaler

<BR><A ID="tex2html243"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/linux5del15.mp4">Reprise fra femte linux-forelesning: linux5del15.mp4</A>
(04:51) Demo: Signaler og trap

<BR><A ID="tex2html244"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del13.mp4">os9del13.mp4</A>
(03:46) Slide: Linux arkitektur

<BR><A ID="tex2html245"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del14.mp4">os9del14.mp4</A>
(03:55) Slide: Windows arkitektur

<BR><A ID="tex2html246"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/video/2021/os9del15.mp4">os9del15.mp4</A>
(13:59) Demo: C-program med fork

<P>

<H3><A ID="SECTION000101100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Slides brukt i forelesningen</A>
</H3>
<A ID="tex2html247"
  HREF="https://www.cs.oslomet.no/~haugerud/os/Forelesning/os9.pdf">Slides brukt i forelesningen</A>
<P>

<H2><A ID="SECTION000102000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Sist</A>
</H2>

<UL>
<LI>Systemkall
</LI>
<LI>Scheduling
</LI>
<LI>OS-vaffelsimulering
</LI>
</UL>

<P>

<H2><A ID="SECTION000103000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Systemkall og timer ticks</A>
</H2>
Et eksempel på et systemkall er getppid som returnerer PID for prosessens parent, foreldre-prosessen som startet prosessen.

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

rex:~$ grep getppid /usr/src/linux-source-4.4.0/arch/x86/entry/syscalls/syscall_64.tbl 
110	common	getppid			sys_getppid
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
Som vi ser er getppid systemkall nummer 110 for Linux sin 4.4 kjerne. Programmeringsspråket C ble laget samtidig som operativsystemet Unix og er dermed også tett beslektet med Linux. Mange av systemkallene i Linux er egne funksjoner i C. Det er tilfellet for getppid og følgende er et C-program som gjør dette systemkallet 10 millioner ganger. 

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

#include&lt;unistd.h&gt;

int main(void) {
   int i;
   for (i=0; i&lt;10000000; i++) {
      getppid();
   }
   return(0);
}
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
Hvis vi ser på timer-ticks før og etter dette programmet, vil vi se at de fleste av tickene finner sted i kernel 
eller system mode. Vi tester dette med følgende script <code>sys.sh</code>:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

#! /bin/bash

grep cpu3 /proc/stat
taskset -c 3 ./getppid
grep cpu3 /proc/stat
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
Dette scriptet starter getppid-programmet på CPU 3 og leser ticks fra den CPUen før og etter. 
Ett tick (også kalt jiffie) varer i 10 millisekunder (ett hundredels sekund) og om for eksempel en CPU bruker all 
tid i user mode når en prosess kjøres på den, vil denne kolonnen øke med 100 ticks i løpet av ett sekund. 
De fire første kolonnene i <code>/proc/stat</code> er som følger:

<P>

<UL>
<LI>user   (1) Time spent in user mode.
</LI>
<LI>nice   (2) Time spent in user mode with low priority (nice).
</LI>
<LI>system (3) Time spent in system mode.
</LI>
<LI>idle   (4) Time spent in the idle task.
</LI>
</UL>

<P>
og resultatet av kjøringen er:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

rex:~$ ./sys.sh 
cpu3 6354414 5212787 2789939 218067966 804787 0 198336 0 0 0
cpu3 6354490 5212787 2790067 218067966 804787 0 198336 0 0 0
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
Vi ser at det kun er kolonnene user (1) og system (3) som har endret seg. Av differansen mellom de to første kolonnene ser vi at ved 76 av tickene som ble foretatt mens programmet kjørte, ble programmet kjørt i user-mode. Av differansen i tredje kolonne, ser vi at 128 av tickene skjedde mens programmet var i system elle kernel-mode. Det siste betyr at operativsystemet utførte et systemkall, getppid, på vegne av programmet som ble startet opp i user-mode. Totalt antall ticks adderer opp til 204 og det betyr at programmet totalt brukte 2.04 sekunder CPU-tid på CPU nr 3.  

<P>
Omtrent det samme kan vi konkludere om vi bruker time-kommandoen til å ta tiden på prosessen:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

rex:~/undervisning/OSogUNIX/unixnotater/virt$ time ./getppid
Real:2.068 User:0.772 System:1.292 99.83%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
som viser at programmet bruker 0.77 sekunder i user-mode og 1.29 sekunder i kernel-mode. Hvis man tar tiden på sys.sh scriptet ser man at det stemmer meget godt overens.

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

rex:~$ time ./sys.sh 
cpu3 6355584 5212992 2790765 218120204 804824 0 198434 0 0 0
cpu3 6355662 5212992 2790894 218120205 804824 0 198434 0 0 0
Real:2.072 User:0.780 System:1.284 99.59%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<H2><A ID="SECTION000104000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN> Prioritet</A>
</H2>
Det er vanlig å kategorisere prosesser og gi dem prioritet etter hvilken kategori de tilhører.

<P>
<IMG
 WIDTH="539" HEIGHT="257" STYLE=""
 SRC="img79.png"
 ALT="\includegraphics[width=12cm]{fig/prioritet.eps}">

<P>
Hvis en prosess i en høyere prioritetsklasse ønsker å kjøre, for eksempel en kjerne-prosess, overtar den med en gang for prosesser fra en lavere prioritetsklasse og kjører til den er ferdig. Innen samme prioritetsklasse tildeles flere timeslices til prosesser med høyere prioritet, slik at de innen samme Round Robin-kø får mer CPU-tid men kjøres samtidig. FCFS (First Come First Served) er en annen scheduler algoritme som brukes for kjerne-tråder (kthreads) som må bli helt ferdige med det de skal gjøre før de avsluttes.

<P>

<H3><A ID="SECTION000104100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Scheduling-algoritmer</A>
</H3>
Scheduling (skedulering) betegner organiseringen av hvordan man tildeler ressurser til en arbeidsoppgave som skal gjennomføres.  I mange sammenhenger trenger man algoritmer som sørger for at en arbeidsoppgave blir effektivt fullført og som fordeler tid eller andre ressurser, organiserer jobbflyt og hvordan prosesser utføres og det trenger ikke nødvendigvis å være prosesser i en datamaskin. Noen vanlige algoritmer er:

<P>

<UL>
<LI>RR (Round Robin) Prosesser kjører på omgang, litt tid hver runde
</LI>
<LI>FCFS (First Come First Served) Den første prosessen blir først prosessert
</LI>
<LI>FIFO (First In Firs Out) Samme som FCFS
</LI>
<LI>SJF (Shortest Job First) Den prosessen som tar kortest tid er den neste som kjøres
</LI>
</UL>

<P>

<H3><A ID="SECTION000104200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Linux-eksempel: nice</A>
</H3> 
<TABLE><TR><TD><PRE >

$ nice -n 9 regn     # Setter nice-verdi til 9 for prosess regn
$ renice +19 25567   # Endrer nice-verdi til 19
</PRE></TD></TR></TABLE>

<UL>
<LI>nice <!-- MATH
 $\longrightarrow$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.05ex; vertical-align: -0.12ex; " SRC="img53.png"
 ALT="$\longrightarrow$"></SPAN> vær snill med andre prosesser
</LI>
<LI>Høyere niceverdi gir mindre CPU-tid til prosessen
</LI>
<LI>default niceverdi er 0
</LI>
<LI>top viser niceverdier
</LI>
</UL>

<P>

<H2><A ID="SECTION000105000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">5</SPAN> Prosess-prioritet i Windows</A>
</H2>
Windows scheduling har store likeheter med Linux. Prosesser får i utgangspunktet en prioritet som 
kan endres dynamisk. CPU-prosesser gis gradvis mindre, I/O prosesser gradvis mer. Det finnes 4 
forhåndsdefinerte prioritetsklasser:

<UL>
<LI>IDLE PRIORITY CLASS (prioritet 4)
</LI>
<LI>NORMAL PRIORITY CLASS (8)
</LI>
<LI>HIGH PRIORITY CLASS (13)
</LI>
<LI>REALTIME PRIORITY CLASS (24)
</LI>
</UL>
Prioritet for en prosess settes til verdier mellom 1 og 31. Prioritet endres dynamisk og prosessen som kjører et aktivt vindu, gis økt prioritet. Dette kan endres fra task-manager hvis man har admin-rettigheter og først velger 'go to details'. Men det er svært stor forskjell på prioritestnivåene som blir satt i task-manager.

<P>

<H2><A ID="SECTION000106000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN> Prosessforløp</A>
</H2>
Denne figuren viser de viktigste tilstandene i et prosessforløp. Prosesser som ligger i ready-list ønsker så snart som mulig å bli tildelt tid i prosessoren og dermed komme over i tilstand running. Prosesser som venter av fri vilje eller som for eksempel må vente på 
Input/Output (I/O) settes i waiting-tilstand. 

<DIV class="CENTER">
<DIV class="CENTER">
<IMG
 WIDTH="544" HEIGHT="234" STYLE=""
 SRC="img80.png"
 ALT="\includegraphics[width=12cm]{fig/prosessforlop.eps}"> 

</DIV>
</DIV>

<P>

<H3><A ID="SECTION000106100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Sentrale schedulingbegreper</A>
</H3>
<DL>
<DT><STRONG>Enqueuer</STRONG></DT>
<DD><UL>
<LI>Legger i kø 
</LI>
<LI>Beregner prioritet 
        
</LI>
</UL>
</DD>
<DT><STRONG>Dispatcher</STRONG></DT>
<DD><UL>
<LI>Velger prosess fra READY LIST; liste med prosesser som er klare til å kjøre
        
</LI>
</UL>
</DD>
</DL>

<P>

<H3><A ID="SECTION000106200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">2</SPAN> Prosessforløp-demo</A>
</H3>

<P>

<video controls width="720">

    <source src="https://os.cs.oslomet.no/os/demoer/prosess.webm"
            type="video/webm">
</video>

<P>
<A ID="tex2html248"
  HREF="https://os.cs.oslomet.no/os/demoer/prosess.mp4">En mp4-demo av dette prosessforløpet kan sees her</A>
<P>

<H2><A ID="SECTION000107000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN> Lage en ny prosess</A>
</H2>
Det mest sentrale konseptet for et operativsystem er prosessen. De følgende avsnitt viser hvordan prosesser fødes, lever og dør på Linux og Windows.
Alle moderne OS har en mekanisme for å lage nye prosesser. Prosesser lages ved

<UL>
<LI>System oppstart (Linux: init-prosessen)
</LI>
<LI>En kjørende prosess utfører et systemkall som staret en ny prosess
</LI>
<LI>En bruker ber om at en prosess startes
</LI>
</UL>

<P>
Bortsett fra ved systemoppstart er det alttid en prosess som lager en annen og den prosessen kalles en forelder-prosess. I prosessverdenen er det bare en forelder til ett eller flere barn. 
En parent-prosess lager en child-prosess. 
<BR>
<BR>
<DIV class="CENTER">
<DIV class="CENTER">
<IMG
 WIDTH="333" HEIGHT="253" STYLE=""
 SRC="img81.png"
 ALT="\includegraphics[width=12cm]{fig/child.pdf}"> 

</DIV>
</DIV>

<P>

<H3><A ID="SECTION000107100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux: fork()</A>
</H3>
fork() er et Linux-systemkall for å lage en child-prosess. fork() lager en kloning, 
identisk prosess med kopi av program, data og PCB (bortsett fra PID, PPID og noen andre).
<BR>
<BR>
<DIV class="CENTER">
<DIV class="CENTER">
<IMG
 WIDTH="453" HEIGHT="300" STYLE=""
 SRC="img82.png"
 ALT="\includegraphics[width=10cm]{fig/fork.pdf}"> 

</DIV>
</DIV>

<P>
Vanligvis starter child med å laste inn koden for det programmet det skal kjøre, slik at child-prosessen likevel blir 
forskjellig fra parent-prosessen. 

<P>
Linux-prosesser lager på denne måten et hierarki av prosesser med barn og barnebarn. Det kan da være mulig å sende signaler til alle prosessene i et hierarki.

<H3><A ID="SECTION000107200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">2</SPAN> Windows: CreateProcess</A>
</H3>
Win 32 API'et har også støtte for fork(), men standardmetoden for å lage en ny prosess er 
å gjøre et kall til <code>CreateProcess</code> med 10 parametre. Da lages et nytt prosess-objekt; hvilket program som skal kjøres, vinduer som skal åpnes, prioritet mm overføres med parameterene til kallet. Bindingen mellom parent og child er ikke like sterk som under Linux. Windowsprosesser kan gjøre sine barn arveløse. 

<P>

<H2><A ID="SECTION000108000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN> Avslutte prosesser</A>
</H2>
Vanligvis avsluttes prosesser når jobben er ferdig. Noen prosesser, såkalte daemons, kjører hele tiden mens systemet er oppe. Prosesser avsluttes ved:

<UL>
<LI>Normal avslutning. Frivillig. Linux: exit, Windows: ExitProcess
</LI>
<LI>Avslutning ved feil. Frivillig. (f. eks. 'file not found')
</LI>
<LI>Fatal feil. Ufrivillig. (division by zero, Segmentation fault, core dumped)
</LI>
<LI>Drept av annen prosess. Ufrivillig. Linux: kill, Windows: TerminateProcess
</LI>
</UL>

<P>

<H3><A ID="SECTION000108100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Signaler</A>
</H3>
Prosesser kan kommunisere med hverandre ved hjelp av signaler. En bruker kan også sende et signal til en prosess, CTRL-C er et eksempel på et slikt signal som prøver å avslutte prosessen. Under Linux kan en prosess selv velge hva den skal gjøre når den mottar et signal. For eksempel er standard oppførsel for en prosess å avslutte når den mottar et CTRL-C signal, men den kan velge å ignorere det. Med kommandoen kill kan man sende mange forskjellige signaler og <code>kill -9</code> er et såkalt ustoppelig signal som dreper prosessen enten den vil eller ikke. For kill-signaler er det en forutsetning at den som sender signalet har riktig rettigheter, ellers vil signalet ikke ha noen effekt.

<P>

<H3><A ID="SECTION000108200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Signaler og trap i bash-script</A>
</H3>
En prosess kan stoppes av andre prosesser og av kjernen. Det gjøres ved å sende 
et signal. Alle signaler bortsett fra SIGKILL (<code>kill -9</code>) kan stoppes og 
behandles av bash-script med kommandoen <code>trap</code>. Følgende script kan bare stoppes 
ved å sende (<code>kill -9</code>) fra et annent shell.

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

#! /bin/bash

# definisjoner fra fra /usr/src/linux-2.2.18/include/asm-i386/signal.h:
#define SIGHUP          1       /* Hangup (POSIX).  */
#define SIGINT          2       /* Interrupt (ANSI).  */
#define SIGKILL         9       /* Kill, unblockable (POSIX).  */
#define SIGTERM         15      /* Termination (ANSI).  */
#define SIGTSTP         20      /* Keyboard stop (POSIX).  */

trap 'echo -e "\rSorry; ignores kill -1 (HUP)\r"' 1
trap 'echo -e "\rSorry; ignores kill -15 (TERM)\r"' 15
trap 'echo -e "\rSorry; ignores CTRL-C\r"' 2
trap 'echo -e "\rSorry; ignores CTRL-Z\r"' 20
trap 'echo -e "\rSorry; ignores kill - 3 4 5\r"' 3 4 5
trap 'echo -e "\rCannot stop kill -9\r"' 9

while [ true ]
do
   echo -en "\a quit? Answer y or n: "
   read answer
   if [ "$answer" = "y" ]
        then break
   fi
done
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<H2><A ID="SECTION000109000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN> OS arkitektur</A>
</H2>
Den vanligste om ikke den beste måten å designe et OS på er en såkalt monolittisk arkitektur. Linux er et typisk eksempel på dette. Alle metoder i koden har tilgang til alle datastrukturer i kjernen. Dette gjør at kjernen blir hurtig og effektiv, men åpner for flere bugs. Windows NT kjernen er objektorientert og skrevet i C++ og har gjennom dette en ryddigere struktur. En ulempe med Windows er at GUI delvis inngår i kjernen slik at den blir mye mer omfattende. En bedre arkitektur er en såkalt microkernel. Bare det helt essensielle utføres av kjernen, som multitasking og behandling av interrupts. Resten utføres utenfor kjernen av prosesser i usermode som kommuniserer med hverandre og mikrokjernen. 

<P>

<H3><A ID="SECTION000109100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux arkitektur</A>
</H3>

<DIV class="CENTER"><A ID="1443"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
<SPAN CLASS="FOOTNOTESIZE">Linux arkitektur</SPAN></CAPTION>
<TR><TD>
<DIV class="CENTER">
<IMG
 WIDTH="544" HEIGHT="270" STYLE=""
 SRC="img83.png"
 ALT="\includegraphics[width=12cm]{fig/osaLinuxArc.eps}"> 

</DIV></TD></TR>
</TABLE>
</DIV>

<P>

<H3><A ID="SECTION000109200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Windows arkitektur</A>
</H3>

<DIV class="CENTER"><A ID="1451"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
<SPAN CLASS="FOOTNOTESIZE">Windows arkitektur</SPAN></CAPTION>
<TR><TD>
<DIV class="CENTER">
<IMG
 WIDTH="543" HEIGHT="412" STYLE=""
 SRC="img84.png"
 ALT="\includegraphics[width=12cm]{fig/osaWinArc.eps}"> 

</DIV></TD></TR>
</TABLE>
</DIV>

<P>

<H2><A ID="SECTION0001010000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">10</SPAN> Design av systemkommandoer</A>
</H2>
Analogt med forholdet mellom privilegert modus og usermodus er forholdet mellom superuser og en vanlig bruker. 
Men et program som kjører som root har bare utvidede rettigheter i forhold til filsystemet og devicer, det kjøres ikke 
som en del av OS-kjernen. 
To muligheter (eksempler fra Linux) ved design av systemkommandoer.

<OL>
<LI>Root-rettigheter (noen få: ping, mount, su, ...)
        
<UL>
<LI>tilgang på alle filer
</LI>
<LI>mye sikkerhets-overhead (alt må sjekkes)
</LI>
<LI>stor sikkerhetsrisiko (kan være sikkerhetshull)
</LI>
<LI>betrodd software
        
</LI>
</UL>
</LI>
<LI>Vanlig bruker-rettigheter (de fleste: ls, ps, mv,...)
        
<UL>
<LI>Sikrere (<EM>begrensede rettigheter</EM>)
</LI>
<LI>Lite feilsjekking <!-- MATH
 $\longrightarrow$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.05ex; vertical-align: -0.12ex; " SRC="img53.png"
 ALT="$\longrightarrow$"></SPAN> lite overhead
        
</LI>
</UL>

<P>
</LI>
</OL>

<P>

<H3><A ID="SECTION0001010100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Linux-eksempel: setuid-bit</A>
</H3>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

group1@osG1:~$ ls -l /bin/ls
-rwxr-xr-x 1 root root 114032 jan.  26  2013 /bin/ls
group1@osG1:~$ ls -l /bin/ping
-rwsr-xr-x 1 root root 36136 april 12  2011 /bin/ping
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN><EM>Kommandoen /bin/ls kjører med vanlige brukerrettigheter, men for /bin/ping 
betyr s'en på eierrettighetene at setuid-bit er satt. Dette betyr at en vanlig 
bruker kjører ping med root-rettigheter. Setuid-programmer er en stor sikkerhetsrisiko. </EM>
Setuid-bit settes med
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

$ chmod 4755 program  # Setter SETUID-bit
$ chmod 0755 program  # Skrur av SETUID-bit
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<H2><A ID="SECTION0001011000000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN> Utbredelse av Operativsystemer</A>
</H2>
Det finnes mange undersøkelser om utbredelsen av operativsystemer og det er vanskelig å få en eksakt oversikt fra åpne kilder. 

<H3><A ID="SECTION0001011100000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Desktop OS</A>
</H3>
Følgende er statistikk for desktop-OS basert på hva slags OS de som er inne på web-sider bruker. Slik så tallene ut i 2007:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

Windows XP      85.30% 
Windows 2000    5.00% 
Mac OS          4.15% 
Windows 98      1.77% 
MacIntel        1.52% 
Windows ME      0.89% 
Windows NT      0.68% 
Linux 	        0.37% 
Windows Vista   0.16% 
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN>
<P>
Tallene er hentet fra 
<A ID="tex2html252"
  HREF=" 
https://marketshare.hitslink.com
">marketshare.hitslink.com. </A>.
De blir laget månedlig fra statistikk over hva slags OS som blir brukt av  
ca 160 millioner besøkende pr måned som er innom mer enn 40.000 forskjellige webservere verden over.
En annen kilde med lignende statistikk er
<A ID="tex2html253"
  HREF=" 
https://gs.statcounter.com
">https://gs.statcounter.com. </A>.

<P>
I 2009 så det slik ut:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

 Windows XP      63.76% 
 Windows Vista 	 22.48% 
 Mac OS X 10.5   5.28% 
 Mac OS X 10.4   2.74% 
 Windows 2000    1.37% 
 Mac OS X        1.00% 
 Linux           0.83% 
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
2012:

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

Desktop Operating System Market Share February, 2012
Windows XP     45.39%
Windows 7      38.12%
Windows Vista  8.10%
Mac OS X 10.6  3.00%
Mac OS X 10.7  2.69%
Linux          1.16%
Mac OS X 10.5  0.95%
Mac OS X 10.4  0.23%
Windows 2000   0.15%
Windows NT     0.06%
Windows 98     0.05%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
2017

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

	TOTAL MARKET SHARE
Windows 7       48.41%
Windows 10      25.19%
Windows XP      8.45%
Windows 8.1	6.87%
Mac OS X 10.12  2.91%
Linux           2.05%
Windows 8       1.65%
Mac OS X 10.11  1.55%
Mac OS X 10.10  1.00%
Windows Vista   0.78%
Windows NT      0.39%
Mac OS X 10.9   0.35%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
2019

<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

Windows 7	40.17%
Windows 10	37.35%
Windows 8.1	4.87%
Mac OS X 10.13	4.36%
Windows XP	3.91%
Mac OS X 10.14	1.88%
Mac OS X 10.12	1.51%
Linux	        1.49%
Windows 8	0.99%
Mac OS X 10.11	0.98%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
2021
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

Windows 10	55.17%
Windows 7	27.09%
Windows 8.1	3.41%
Mac OS X 10.14	3.34%
Mac OS X 10.15	2.96%
Mac OS X 10.13	1.52%
Linux	Linux	1.37%
Windows XP	1.35%
Linux	Ubuntu	0.81%
Mac OS X 10.12	0.65%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<DIV class="CENTER"><A ID="1489"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
<SPAN CLASS="FOOTNOTESIZE">Slik så trenden ut mellom 2018 og 2019, ikke så store endringer frem til 2021.</SPAN></CAPTION>
<TR><TD>
<DIV class="CENTER">
<IMG
  WIDTH="605" HEIGHT="274" STYLE=""
 SRC="./winTrend20.png"
 ALT="Image winTrend20"> 

</DIV></TD></TR>
</TABLE>
</DIV>

<P>
Tilsvarende tall for webbrowsere er som følger;
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2007
Internet Explorer  79.64% 
Firefox            14.00% 
Safari 	           4.24% 
Opera 	           0.87% 
Netscape           0.85% 
Mozilla            0.22% 
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2009
Internet Explorer  67.55% 
Firefox            21.53% 
Safari             8.29% 
Chrome             1.12% 
Opera              0.70% 
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN><SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2012
Internet Explorer  52.84%
Firefox            20.92%
Chrome             18.90%
Safari             5.24%
Opera              1.71%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2017
Chrome             58.22%
Internet Explorer  19.45%
Firefox            11.73%
Microsoft Edge     5.51%
Safari             3.46%
Opera              1.26%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2019
Chrome	          65.00%
Internet Explorer 10.23%
Firefox	          9.72%
Edge	          4.33%
Safari	          3.74%
Opera	          1.57%
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>
<SPAN CLASS="SPAN"></SPAN><TABLE><TR><TD><PRE >

2021
Chrome	                68.75
Firefox	                7.91
Edge	                7.36
Internet Explorer	5.86
Safari	                3.64
QQ	                1.76
Sogou Explorer	        1.67
Opera	                1.22
</PRE></TD></TR></TABLE><SPAN CLASS="SPAN">
</SPAN>
<P>

<H3><A ID="SECTION0001011200000000000000">
<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Server OS</A>
</H3>
Servertall er vanskligere å finne fra åpne kilder. Netcrafts rapport fra Mars 2008 visete at av de 162 millioner webserverene de hadde mottatt 
respons fra i sin undersøkelse, kjørte ca 60% apache(typisk med Linux som OS), ca 30% Microsoft webserver og 10% på andre plattformer. 
Fire år etter så det litt anderledes ut, apache hadde økt andelen noe.
(<A ID="tex2html254"
  HREF="
http://news.netcraft.com/archives/2012/03/05/march-2012-web-server-survey.html
">Se detaljer her.</A>)
I 2019 hadde bildet endret seg med flere Microsoft webservere og 
(<A ID="tex2html255"
  HREF="

https://news.netcraft.com/archives/2019/02/28/february-2019-web-server-survey.html
  ">detaljene kan sees her.</A>)

<P>
I 2020 har bildet igjen endret seg og Nginx er den mest brukte webserveren.  
(<A ID="tex2html256"
  HREF="
https://news.netcraft.com/archives/2020/
  ">detaljene kan sees her.</A>)

<P>
Det mest korrekte bildet får man trolig av å se på 'active sites' som har reelle webservere
 som leverer innhold og ikke kun er reklame for f.eks. salg av domenenavn.

<P>
<A ID="tex2html257"
  HREF="
https://en.wikipedia.org/wiki/Usage_share_of_operating_systems
">En wikipedia artikkel</A>
prøver å gi en oversikt over utbredelse av server-OS.

<P>

<BR><HR>
<ADDRESS>
H&aring;rek Haugerud 2026-01-13
</ADDRESS>
</BODY>
</HTML>
